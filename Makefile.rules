#
# Makefile rules for compiling examples.
#

vpath %.f90 $(VPATHS)
vpath %.c   $(VPATHS)

$(EXE): $(OBJ)
	$(FC) $(FFLAGS) $^ $(OUTPUT_OPTION) $(LDFLAGS)

build/%.o: %.f90
	@mkdir -p build
	$(FC) $(FFLAGS) -c $< $(OUTPUT_OPTION)

build/%.o: %.c
	@mkdir -p build
	$(CC) $(CFLAGS) -c $< $(OUTPUT_OPTION)

.PHONY: clean

clean:
	find . -name build | xargs rm -rf
	find . -name '*.exe' | xargs rm -f

#
# LIBPFASST dependencies
#

build/pf_timer.o:       build/pf_dtype.o
build/pf_cycle.o:       build/pf_dtype.o
build/pf_ndarray.o:     build/pf_dtype.o
build/pf_utils.o:       build/pf_timer.o
build/pf_explicit.o:    build/pf_timer.o
build/pf_hooks.o:       build/pf_timer.o
build/pf_hooks.o:       build/pf_timer.o
build/pf_implicit.o:    build/pf_timer.o
build/pf_mpi.o:         build/pf_timer.o
build/pf_logger.o:      build/pf_hooks.o
build/pf_imex.o:        build/pf_timer.o build/pf_explicit.o build/pf_implicit.o
build/pf_restrict.o:    build/pf_utils.o build/pf_timer.o build/pf_hooks.o
build/pf_interpolate.o: build/pf_restrict.o build/pf_hooks.o
build/pf_parallel.o:    build/pf_interpolate.o build/pf_hooks.o build/pf_cycle.o
build/pf_fake.o:        build/pf_parallel.o build/pf_fakecomm.o
build/sdc_quadrature.o: build/pf_dtype.o build/sdc_poly.o
build/pf_quadrature.o:  build/sdc_quadrature.o
build/pf_pfasst.o:      build/pf_utils.o build/pf_quadrature.o \
                        build/pf_cycle.o build/pf_hooks.o
build/pf_pthreads.o:    build/pf_timer.o build/pf_pfasst.o
build/pf_fakecomm.o:    build/pf_timer.o build/pf_pfasst.o

ifdef NOMPI
build/pfasst.o:         build/pf_parallel.o build/pf_fake.o build/pf_pfasst.o \
                        build/pf_implicit.o build/pf_explicit.o build/pf_imex.o \
                        build/pf_pthreads.o build/pf_cpthreads.o \
                        build/pf_version.o build/pf_logger.o build/pf_cycle.o \
                        build/pf_ndarray.o
else
build/pfasst.o:         build/pf_parallel.o build/pf_fake.o build/pf_pfasst.o \
                        build/pf_implicit.o build/pf_explicit.o build/pf_imex.o \
                        build/pf_mpi.o build/pf_pthreads.o build/pf_cpthreads.o \
                        build/pf_version.o build/pf_logger.o build/pf_cycle.o \
                        build/pf_ndarray.o
endif
