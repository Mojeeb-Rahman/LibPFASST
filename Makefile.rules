#
# Makefile rules for compiling examples.
#

vpath %.f90 $(VPATHS)
vpath %.c   $(VPATHS)
vpath %.f   $(VPATHS)

$(EXE): $(OBJ)
ifdef MKVERBOSE
	$(FC) $(FFLAGS) $^ $(OUTPUT_OPTION) $(LDFLAGS)
else
	@echo "Linking..."
	@$(FC) $(FFLAGS) $^ $(OUTPUT_OPTION) $(LDFLAGS)
endif

build/%.o build/%.mod: %.f90
	@mkdir -p build
	@mkdir -p include
ifdef MKVERBOSE
	$(FC) $(FFLAGS) -c $< $(OUTPUT_OPTION)
else
	@echo "Building $<..."
	@$(FC) $(FFLAGS) -c $< $(OUTPUT_OPTION)
endif

build/%.o: %.c
	@mkdir -p build
	@mkdir -p include
ifdef MKVERBOSE
	$(CC) $(CFLAGS) -c $< $(OUTPUT_OPTION)
else
	@echo "Building $<..."
	@$(CC) $(CFLAGS) -c $< $(OUTPUT_OPTION)
endif

build/%.o: %.f
	@mkdir -p build
	@mkdir -p include
ifdef MKVERBOSE
	$(FC) $(F77FLAGS) -c $< $(OUTPUT_OPTION)
else
	@echo "Building $<..."
	@$(FC) $(F77FLAGS) -c $< $(OUTPUT_OPTION)
endif

.PHONY: clean

clean:
	find . -name build | xargs rm -rf
	find . -name '*.exe' | xargs rm -f
	\rm -f fort.* *.slog2 *.edf *.trc gmon.out
	\rm include/*.mod

#
# LIBPFASST dependencies
#
build/pf_comm.o:        build/pf_dtype.o
build/pf_timer.o:       build/pf_dtype.o
build/pf_ndarray.o:     build/pf_dtype.o
build/pf_ndarray-oc.o:  build/pf_dtype.o
build/pf_utils.o:       build/pf_timer.o
build/pf_hooks.o:       build/pf_timer.o
build/pf_mpi.o:         build/pf_timer.o build/pf_dtype.o
build/pf_imexQ.o:       build/pf_dtype.o build/pf_timer.o  build/pf_utils.o build/pf_hooks.o
build/pf_imexQ_oc.o:    build/pf_dtype.o build/pf_timer.o  build/pf_utils.o build/pf_hooks.o
build/pf_rkstepper.o:   build/pf_dtype.o build/pf_timer.o  build/pf_utils.o
build/pf_restrict.o:    build/pf_utils.o build/pf_timer.o build/pf_hooks.o
build/pf_interpolate.o: build/pf_restrict.o build/pf_hooks.o
build/pf_magnus_picard.o:  build/pf_dtype.o build/pf_hooks.o build/pf_utils.o build/pf_hooks.o
build/pf_imk.o:         build/pf_dtype.o build/pf_timer.o build/pf_hooks.o build/pf_utils.o
build/pf_parallel.o:    build/pf_interpolate.o build/pf_hooks.o build/pf_pfasst.o  build/pf_comm.o 
build/pf_parallel_oc.o: build/pf_interpolate.o build/pf_hooks.o build/pf_pfasst.o  build/pf_comm.o 
build/pf_fake.o:        build/pf_parallel.o build/pf_fakecomm.o
build/pf_quadrature.o:  build/pf_dtype.o
build/pf_pfasst.o:      build/pf_utils.o build/pf_quadrature.o  build/pf_hooks.o build/pf_mpi.o 
build/pf_fakecomm.o:    build/pf_timer.o build/pf_pfasst.o

ifdef NOMPI
build/pfasst.o:         build/pf_parallel.o build/pf_pfasst.o  build/pf_imexQ.o build/pf_imexQ_oc.o build/pf_rkstepper.o 
else
build/pfasst.o:         build/pf_parallel.o  build/pf_pfasst.o build/pf_mpi.o build/pf_imexQ.o build/pf_rkstepper.o 
endif

#build/pf_misdcQ.o:      build/pf_dtype.o build/pf_timer.o build/pf_utils.o build/pf_hooks.o
#build/pf_misdc.o:       build/pf_timer.o build/pf_explicit.o build/pf_implicit.o build/pf_utils.o
#build/pf_amisdc.o:      build/pf_timer.o build/pf_explicit.o build/pf_implicit.o build/pf_utils.o
#build/pf_amisdcQ.o:      build/pf_timer.o build/pf_explicit.o build/pf_implicit.o build/pf_utils.o























